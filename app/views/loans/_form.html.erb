<%= form_with model: @loan, class: "form" do |form| %>

<body style="background-color: rgb(165, 236, 192)">
  <div class="container">
    <br>
    <div class="row">
      <div class="col-lg-12 text-center">
        <h3 style="font-weight: bold; margin-bottom: 30px">
          How much do you need?
        </h3>
      </div>
    </div>

    <div class="row">
        <div class="col-lg-4">
          <div class="form-group">
            <%= form.label :purpose, "Loan Purpose" %>
            <%= form.select :purpose, Loan.purposes.keys, { prompt: "Select Loan Purpose" }, class: "custom-select form-control" %>
          </div>
          
          <br>
          <div class="form-group">
            <%= form.label :amount, "Loan Amount" %>
            <%= form.text_field :amount, class: "form-control", placeholder: "$2,000.00",maxlength: 10, oninput: 'maskLoanAmount(this)' %>
          </div>
        </div>
    </div>
    <br>
    <div class="row">
      <div class="col-lg-12 text-center">
          <h3 style="font-weight:bold; margin-bottom: 30px;">Tell Us About Yourself</h3>
      </div>
   </div>
   <br>
     <div class="row">
        <div class="col-lg-4">
          <div class="form-group">
            <%= form.label :name, "First Name" %> <%= form.text_field :name, class:
            "form-control", placeholder: "Your First Name" %>
          </div>
        </div>

        <div class="col-lg-4">
          <div class="form-group">
            <%= form.label :middle_name, "Middle Name (Optional)" %> <%= form.text_field :middle_name, class:
            "form-control", placeholder: "Your Middle Name" %>
          </div>
        </div>

        <div class="col-lg-4">
          <div class="form-group">
            <%= form.label :last_name %> <%= form.text_field :last_name, class:
            "form-control", placeholder: "Your Last Name" %>
          </div>
        </div>
      </div>
      <br>

      <div class="row">
        <div class="col-lg-4">
          <div class="form-group">
              <%= form.label :date_of_birth %>
              <%= form.text_field :date_of_birth, class: 'form-control datepicker', placeholder: 'Date of Birth', autocomplete: 'off' %>                       
          </div>
        </div>
        

        <div class="col-lg-4">
          <div class="form-group">
            <%= form.label :email %> <%= form.email_field :email, class:
            "form-control", placeholder: "Your Email" %>
          </div>
        </div>
      </div>
      <br>

      <div class="row">
        <div class="col-lg-4">
          <div class="form-group">
            <%= form.label :phone_number %>
            <%= form.text_field :phone_number, class: "form-control", placeholder: "(XXX) XXX-XXXX", pattern: '\(\d{3}\) \d{3}-\d{4}', maxlength: 14, oninput: 'formatPhoneNumber(this)' %>
          </div>
        </div>

        <div class="col-lg-4">
         
          <div class="form-group">
            <%= form.label :home_number %>
            <%= form.text_field :home_number, class: "form-control", placeholder: "(XXX) XXX-XXXX", pattern: '\(\d{3}\) \d{3}-\d{4}', maxlength: 14, oninput: 'formatHomePhoneNumber(this)' %>
          </div>
        </div>

        <div class="col-lg-4">
          <div class="form-group">
            <%= form.label :ssn, style: "text-transform: uppercase;" %>
            <%= form.text_field :ssn, class: "form-control", placeholder: "XXX-XX-XXXX", pattern: '\d{3}-\d{2}-\d{4}', maxlength: 11, oninput: 'formatSSN(this)' %>
          </div>
        </div>
      </div>
      <br>

      <div class="row">
        <div class="col-lg-12 text-center">
            <h3 style="font-weight:bold; margin-bottom: 30px;">What is your home address</h3>
        </div>
     </div>

     <div class="row">
      <div class="col-lg-4">
        <div class="form-group">
          <%= form.label :address, "Street Address 1"   %> <%= form.text_field :address, class:
          "form-control", placeholder: "Your Address 1" %>
        </div>
          <br>
          <div class="form-group">
            <%= form.label :street_address2, "Street Address 2(Optional)" %> <%= form.text_field :street_address2, class:
            "form-control", placeholder: "Your Address 2" %>
          </div>
      </div>
    </div>
    <br>

    <div class="row">
      <div class="col-lg-4">
        <div class="form-group">
          <%= form.label :city %> <%= form.text_field :city, class:
          "form-control", step: 0.01, placeholder: "City" %>
        </div>
      </div>
      <div class="col-lg-4">
        <div class="form-group">
          <%= form.label :state %> <%= form.text_field :state, class:
          "form-control", step: 0.01, placeholder: "Rajasthan" %>
        </div>
      </div>
      <div class="col-lg-4">
        <div class="form-group">
          <%= form.label :zip %> 
          <%= form.text_field :zip, class: "form-control", placeholder: "342002", maxlength: 5, oninput: 'formatZip(this)' %>
        </div>
      </div> 
   </div>
   <br>

   <div class="row">
    <div class="col-lg-4">
      <div class="form-group">
        <%= form.label :residence_type %> <%= form.text_field :residence_type, class:
        "form-control", step: 0.01 %>
      </div>
    </div>
   </div>
 <br>
    <div class="row">
      <div class="col-lg-12 text-center">
          <h3 style="font-weight:bold; margin-bottom: 30px;">How much do you make</h3>
      </div>
    </div>
<br>

      <div class="row">
        <div class="col-lg-4">
          <div class="form-group">
            <%= form.label :annual_income, "Annual Income" %> <%= form.text_field :annual_income, class:
            "form-control", step: 0.01, placeholder: "Your Monthly Income",maxlength: 8, oninput: 'maskIncome(this)' %>
          </div>
        </div>

        <div class="col-lg-4">
            <div class="form-group">
            <%= form.label :employer_name %> <%= form.text_field :employer_name, class:
            "form-control", step: 0.01 %>
          </div>
        </div>
        
        <div class="col-lg-4">
          <div class="form-group">
            <%= form.label :employer_phone %>
            <%= form.text_field :employer_phone, class: "form-control", placeholder: "(XXX) XXX-XXXX", pattern: '\(\d{3}\) \d{3}-\d{4}', maxlength: 14, oninput: 'formatEmployerPhoneNumber(this)' %>
          </div>
      </div>
     </div>
    <br>
    <div class="row" >
      <div class="col-lg-12 text-center" >
        <%= form.submit "Submit", class: "btn btn-primary" %>
      </div>
   </div> 
    <% end %>
</div>

<script>
 function formatSSN(input) {
  var value = input.value.replace(/\D/g, '');

  if (value.length > 5) {
    value = value.slice(0, 3) + '-' + value.slice(3, 5) + '-' + value.slice(5, 9);
  } else if (value.length > 2) {
    value = value.slice(0, 3) + '-' + value.slice(3, 5);
  }

  input.value = value;
}


  function formatPhoneNumber(input) {
    var value = input.value.replace(/\D/g, '');
    if (value.length > 6) {
      value = '(' + value.slice(0, 3) + ') ' + value.slice(3, 6) + '-' + value.slice(6, 10);
    } else if (value.length > 3) {
      value = '(' + value.slice(0, 3) + ') ' + value.slice(3, 6);
    }
    input.value = value;
  }

  function formatHomePhoneNumber(input) {
    var value = input.value.replace(/\D/g, '');
    if (value.length > 6) {
      value = '(' + value.slice(0, 3) + ') ' + value.slice(3, 6) + '-' + value.slice(6, 10);
    } else if (value.length > 3) {
      value = '(' + value.slice(0, 3) + ') ' + value.slice(3, 6);
    }
    input.value = value;
  }
  function formatEmployerPhoneNumber(input) {
    var value = input.value.replace(/\D/g, '');
    if (value.length > 6) {
      value = '(' + value.slice(0, 3) + ') ' + value.slice(3, 6) + '-' + value.slice(6, 10);
    } else if (value.length > 3) {
      value = '(' + value.slice(0, 3) + ') ' + value.slice(3, 6);
    }
    input.value = value;
  }

  function maskLoanAmount(inputElement) {
  let inputValue = inputElement.value;

  // Remove non-numeric characters except for the dot (.)
  inputValue = inputValue.replace(/[^\d.]/g, '');

  // Convert to a floating-point number
  let numericValue = parseFloat(inputValue);

  // Check if the input is a valid number
  if (isNaN(numericValue)) {
    // If input is not a valid number, set the value to an empty string
    inputElement.value = '';
    return; // Exit the function
  }

  // Limit the number of decimal places to two
  numericValue = parseFloat(numericValue.toFixed(2));

  // Format the number as currency using toLocaleString
  const formattedAmount = numericValue.toLocaleString("en-US", {
    style: "currency",
    currency: "USD",
    maximumFractionDigits: 0,
  });

  console.log("formattedAmount", formattedAmount);

  // Update the input element with the formatted value
  inputElement.value = formattedAmount;
}

function maskIncome(inputElement) {
  let inputValue = inputElement.value;

  inputValue = inputValue.replace(/[^\d.]/g, '');

  // Convert to a floating-point number
  let numericValue = parseFloat(inputValue);

  // Check if the input is a valid number
  if (isNaN(numericValue)) {
    inputElement.value = '';
    return; // Exit the function if the input is not a valid number
  }

  // Round to the nearest integer
  numericValue = Math.round(numericValue);

  // Format the number as currency using toLocaleString
  const formattedAmount = numericValue.toLocaleString("en-US", {
    style: "currency",
    currency: "USD",
    maximumFractionDigits: 0, // Set to 0 to remove the decimal part
  });

  console.log("formattedAmount", formattedAmount);

  // Update the input element with the formatted value
  inputElement.value = formattedAmount;
}

function formatZip(input) {
  // Remove non-numeric characters
  var value = input.value.replace(/\D/g, '');

  // Limit the length to 5 digits
  value = value.slice(0, 5);

  // Update the input value
  input.value = value;
}

document.addEventListener('DOMContentLoaded', function() {
    flatpickr('.datepicker', {
      enableTime: false,
      dateFormat: "Y-m-d",
      maxDate: "today",
    });
  });

  
</script>


<!-- Add these lines to include Bootstrap and Flatpickr JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/default.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css"></script>

</body>
